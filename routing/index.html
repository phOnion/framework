<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Introduction - Onion - Framework</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Introduction";
    var mkdocs_page_input_path = "routing\\index.md";
    var mkdocs_page_url = "/routing/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Onion - Framework</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Intro</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../setup/">Tutorial</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Dependency</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../dependency/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../dependency/invokables/">Invokables</a>
                </li>
                <li class="">
                    
    <a class="" href="../dependency/factories/">Factories</a>
                </li>
                <li class="">
                    
    <a class="" href="../dependency/shared/">In-memory Caching</a>
                </li>
                <li class="">
                    
    <a class="" href="../dependency/caching/">Persistent Caching</a>
                </li>
                <li class="">
                    
    <a class="" href="../dependency/delegation/">Delegation</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Routing</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">Introduction</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#introduction">Introduction</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#definition">Definition</a></li>
        
            <li><a class="toctree-l4" href="#route-types">Route types</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../hydratable/">Hydration</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../collections/">Collections</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../rest/">Rest</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Advanced</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../modules/">Modules</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Onion - Framework</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Routing &raquo;</li>
        
      
    
    <li>Introduction</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="introduction">Introduction</h1>
<p>Since the <code>Router</code> class has been removed in the 2.0 release the concept of routing
has been moved to the application class + the dispatching has been moved inside the
Route classes hance making them self-contained and responsible for their own execution.</p>
<p>Thus the <code>Application</code> class has absolutely no knowledge of how the route is dispatched
it just "asks" it if it matches the current request and if it is - handles the sending
of the response to the client.</p>
<p>The route definition structure has not changed much:</p>
<pre><code class="php">return [
    'routes' =&gt; [
        [
            'name' =&gt; 'home', // Optional
            'pattern' =&gt; '/', // Required. Not changed at all
            'methods' =&gt; [], // Optional
            'class' =&gt; \Onion\Framework\Router\StaticRoute::class, // New! Optional, what class to use when building the route
            'headers' =&gt; [ // NEW! Optional, a list of headers to enforce to the route's response
                'x-random-stuff' =&gt; true,
                'x-more-random-stuff' =&gt; false,
            ],
            'request_handler' =&gt; 'RequestHandlerKey', // NEW! Optional, instance to directly attach to the route
            'middleware' =&gt; [] // Required. List of keys for the middleware of the route, omitted if `request_handler` is present
        ]
    ]
];
</code></pre>

<p>If a custom <code>class</code> is provided, it will be used for managing the route. That way a custom dispatch strategy could be used
and/or changes of pattern syntax and what not. As for <code>headers</code> it is intended to validate required headers to a response of the route
on success. Things like explicitly setting HTTP Cache value for example can be added here and remove the need for adding
data to the logic or implement some sort of a redirect route.</p>
<h2 id="definition">Definition</h2>
<p>The full route structure looks like this:</p>
<pre><code class="php">[
    'name' =&gt; 'alias-name', // Optional
    'pattern' =&gt; '/products/{product}', // Required
    'class' =&gt; SomeRoute::class, // Optional
    'request_handler' =&gt; SomeRequestHandler::class, // Optional
    'middleware' =&gt; [ // Required, if `request_handler` is not present
        // list of middleware keys to resolve
    ],
    'methods' =&gt; [ // Optional
        // list of HTTP methods
    ],
    'headers' =&gt; [ // Optional
        'x-header-name' =&gt; true // Definition of a route header
    ]
]
</code></pre>

<ul>
<li><code>'name'</code> - An alias for a route useful if resolving pattern to route</li>
<li><code>'pattern'</code> - The pattern of the route</li>
<li><code>'request_handler'</code> - A request handler to use, bypassing the use of middleware (Useful for modules)</li>
<li><code>'middleware'</code> - A list of middleware keys that handle the route. Ignored if <code>request_handler</code> is present</li>
<li><code>'class'</code> - A class which will handle the route (Defaults to <code>RegexRoute</code>)</li>
<li><code>'methods'</code> - A list of HTTP methods to restrict the route to. Useful for early termination</li>
<li><code>'headers'</code> - A list of headers to enforce in the request and mark them as required or not</li>
</ul>
<p>Route headers could be handy when needing to enforce a rule on a given route.
For example require the requests to provide an <code>Authorization</code> header will
have <code>'Authorization' =&gt; true</code> enforcing it and if it is not provided non of the
middleware stack will be triggered and the app will return early. Making you
not have to check if the header is present all over the place. This can be of a
huge benefit if a module is entirely user protected to restrict access to it.</p>
<h2 id="route-types">Route types</h2>
<h3 id="1-staticroute">1. <code>StaticRoute</code></h3>
<p>Handles the request path as is, without doing anything behind the scenes and triggers it's stack directly.</p>
<h3 id="2-regexroute">2. <code>RegexRoute</code></h3>
<p>This route is the default one used by the default application factory.
As the name implies it is a regex-based routing that supports optional
parameters and parameter validation in it's syntax. To access route
parameters you must use <code>$request-&gt;getAttribute('parameterName');</code> from
the incoming request.</p>
<h4 id="pattern-syntax">Pattern Syntax</h4>
<p>In order to define a parameter you must surround the "key" with square
braces <code>{parameter}</code> and in the common scenario you are done. For example the
following pattern has a parameter named <code>id</code>, which is required: <code>/products/{id}</code>.</p>
<h4 id="optional-params">Optional Params</h4>
<p>Optional parameters use the same syntax, you just have to add question makr
<code>?</code> ath end of the param and you are good, like <code>{parameter}?</code>.
Updating the same example as before with making the <code>id</code> parameter optional:
<code>/product/{id}?</code>. Note that the <code>/</code> is before the parameter name and that will
make it required. If you want to avoid having that, you can surround your parameter
part of an optional group by doing this: <code>/product{/{id}}?</code> this will
indicate that the trailing slash is required only when the has a value
for <code>{id}</code> provided.</p>
<h4 id="parameter-constraints">Parameter Constraints</h4>
<p>In order to put constraints on a route we can use <code>:</code> after the parameter
name to denote that what is after it and before the <code>}</code> is a pattern.
For example to enforce our <code>{id}</code> parameter from above to accept only integers
we can define it as such: <code>/product{/{id:\d+}}?</code> that way if it is present
it will have to be of 1+ numeric characters.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../hydratable/" class="btn btn-neutral float-right" title="Hydration">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../dependency/delegation/" class="btn btn-neutral" title="Delegation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../dependency/delegation/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../hydratable/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
