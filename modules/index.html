<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Modules - Onion - Framework</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Modules";
    var mkdocs_page_input_path = "modules.md";
    var mkdocs_page_url = "/modules/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Onion - Framework</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Intro</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../setup/">Tutorial</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Dependency</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../dependency/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../dependency/invokables/">Invokables</a>
                </li>
                <li class="">
                    
    <a class="" href="../dependency/factories/">Factories</a>
                </li>
                <li class="">
                    
    <a class="" href="../dependency/shared/">In-memory Caching</a>
                </li>
                <li class="">
                    
    <a class="" href="../dependency/caching/">Persistent Caching</a>
                </li>
                <li class="">
                    
    <a class="" href="../dependency/delegation/">Delegation</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Routing</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../routing/">Introduction</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../hydratable/">Hydration</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../collections/">Collections</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../rest/">Rest</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Advanced</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">Modules</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#introduction">Introduction</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#setup">Setup</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Onion - Framework</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Advanced &raquo;</li>
        
      
    
    <li>Modules</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="introduction">Introduction</h1>
<p>Modules are a way to separate the application in order to preserve separation
of code components and avoid your application to grow in to a monolith that
is going to kill a kitten, destroy the world, make you insane and/or send
you to hell. So to allow this, the modules are designed to be separated
based on a route prefix. In order to achieve that.</p>
<p>In order to achieve that, You will probably need a localized routes defs
that will be loaded throughout the module and utilize the DelegateContainer
to resolve the remaining dependencies.</p>
<h2 id="setup">Setup</h2>
<p>In this example we would assume you want to have a module that is handling
the <code>/integrations</code> prefix in your app. So first we will go through adding
the definition for a route to the global application:</p>
<pre><code class="php">return [
    [
        'name' =&gt; 'integrations',
        'pattern' =&gt; '/integrations',
        'request_handler' =&gt; 'IntegrationsModule',
        'class' =&gt; \Onion\Framework\Router\PrefixRoute::class,
        'headers' =&gt; [
            'Authorization' =&gt; true,
        ]
    ]
];
</code></pre>

<p><em>Note we've omitted the <code>middleware</code> key.</em></p>
<p>This will ensure that whenever we receive a request that starts with
<code>/integrations</code> it will be sent to that request handler while also requiring
the client to provide an <code>authorization</code> header for access, and register it
in the container as <code>IntegrationsModule</code>. From there for the executed routes
the request will come as if there was never a prefix as it will get stripped
to allow the applications to not have coupling to the routing they have.
For example, every route you define in the <em>module</em> must not contain the
prefix or the routing will match only <code>/integrations/integrations/...</code>
and we don't want to do that, right?</p>
<p>With that being said a factory for our imaginary module would look more
or less like this:</p>
<pre><code class="php">&lt;?php
namespace App\Module\Integration;

// imports...

class IntegrationModuleFactory implements FactoryInterface
{
    private getLocalContainer(): ContainerInterface
    {
        return new Container(compileConfigFiles(__DIR__ . '/../../config'));
    }

    public function build($delegateContainer)
    {
        // Note here we need to retrieve the main application
        return $this-&gt;getLocalContainer()-&gt;get(Application::class);
    }
}
</code></pre>

<p>And from here on the routing takes care of it and when the route matches
in the parent application it will hand over the execution to the module
and we are done. The middleware will stack between the application and
module. Just when you are intentionally building a module, you might want
to exclude an error handler in the modules in order to allow the application
itself to handle the error handling, although that will depend entirely on
your design and components the possibilities are more or less limitless.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../rest/" class="btn btn-neutral" title="Rest"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../rest/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
